{% comment %} 
Block that renders an external tool view. At the moment, that just
means a button that launches the tool in a separate tab. But in the future, it
could be an iframe or something else. 

The launch process involves
1. The initial URL points to a view in KinesinLMS, which creates an LTI launch
   request and returns a "redirect" to the user's browser
2. The browser follows the redirect to the LTI tool provider, which authenticates
   the user and then redirects back to the 'callback' view method in KinesinLMS
3. The callback view method processes the LTI launch request and then redirects
   to the actual tool URL

{% endcomment %}

{% load static lti_extras %}

<div id="block_{{ block.id }}" class="block block-external-tool-view">
  {% if block_view_context == "COMPOSER" %}

    <div class="text-muted">This is a jupyter notebook.</div>
    <div>
      <table class="table table-bordered table-sm mt-2" style="max-width:50rem;">
        {% for resource in block.resources.all %}
          {% if resource.type == "JUPYTER_NOTEBOOK" %}
            <tr>
              <td style="width:12rem;">Notebook location</td>
              <td>{{ resource.resource_file }}</td>
            </tr>
          {% endif %}
        {% endfor %}
      </table>
    </div>

  {% else %}

    <h3>External Tool</h3>
    {# TODO: support iframe launch, etc. #}

    {% with block.external_tool_view.external_tool_provider.type as tool_type %}

      {% if tool_type == "BASIC_LTI13" %}

        {% include "course/blocks/external_tool_block/lti_external_tool.html" %}

      {% elif tool_type == "MODAL_COM" %}

        {% include "course/blocks/external_tool_block/modal_com_external_tool.html" %}

      {% else %}
        <h1>Unsupported tool type: {{ tool_type }}</h1>
      {% endif %}
    {% endwith %}
  {% endif %}
</div>
